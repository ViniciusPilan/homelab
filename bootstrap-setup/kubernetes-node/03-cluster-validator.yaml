apiVersion: v1
kind: Pod
metadata:
  labels:
    app: cluster-validator-a
  name: cluster-validator-a
  namespace: default
spec:
  tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Equal"
    effect: "NoSchedule"
  containers:
  - image: docker.io/library/nginx:latest
    name: cluster-validator
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: cluster-validator-a
  name: cluster-validator-a
  namespace: default
spec:
  ports:
  - name: http
    port: 80
  selector:
    app: cluster-validator-a
  type: ClusterIP
---
apiVersion: batch/v1
kind: Job
metadata:
  name: cluster-validator
  namespace: default
spec:
  template:
    metadata: {}
    spec:
      tolerations:
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Equal"
        effect: "NoSchedule"
      containers:
      - image: docker.io/library/busybox:latest
        name: sleep
        command: ["/bin/sh", "-c"]
        args: ["sleep 15"]
      - image: docker.io/library/nginx:latest
        name: cluster-validator
        resources: {}
        command: ["/bin/bash", "-c"]
        args: ["curl cluster-validator-a.default.svc.cluster.local"]
      restartPolicy: Never
